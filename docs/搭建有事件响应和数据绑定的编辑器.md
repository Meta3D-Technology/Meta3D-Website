---
sidebar_position: 5
---

# 搭建有事件响应和数据绑定的编辑器

在本文中，您将学习到：

- 如何为编辑器的页面控件UIControl监听事件，绑定handler
- 如何构建编辑器的页面数据，并将其与控件UIControl绑定


我们将搭建的编辑器会有一个Window控件，它包含一个Button控件作为child。点击该Button后会将该Button沿着水平方向往右边移动一段距离

在线运行的截图如下：
![运行截图.png](/img/搭建有事件响应和数据绑定的编辑器/运行截图.png)

基本原理是：
我们为页面增加一个数据x；
我们将页面的reducer与Action绑定；
我们将Button->Rect->PositionX与数据x绑定；
因为我们实现了类似于[redux](https://redux.js.org/)的机制，所以当click button时，会执行Action贡献的handler，从而dispatch changeX action and new state，从而更新页面的数据x而使得PositionX也更新，从而使得Button移动；

下面我们来一步步操作：
## 获得需要的扩展、贡献 

这个编辑器需要下面的扩展：
- most（实现的协议名：most protocol）
- event（实现的协议名：event protocol）
- imgui-webgl1-renderer（实现的协议名：renderer protocol）
- immutable（实现的协议名：immutable protocol）
- ui（实现的协议名：ui protocol）
- webgl1（实现的协议名：webgl1 protocol）
- run-engine-empty（实现的协议名：run engine protocol）
- use empty（实现的协议名：use editor protocol）
该扩展为应用的启动扩展

这个编辑器需要下面的贡献：
- meta3d-action-click-button（实现的协议名：meta3d-action-click-button-protocol）
该贡献属于Action类型，负责处理click button事件
- window（实现的协议名：window protocol）
- button（实现的协议名：button protocol）
该贡献属于UIControl类型，调用了ui扩展中关于Button的绘制API


我们从扩展市场和贡献市场中选择它们


## 搭建编辑器页面

现在我们来可视化地搭建编辑器页面，绑定数据和Action：
- 进入装配空间，依次选中我们在市场上选择的扩展和贡献
- 设置页面的宽度为800px，高度为600px
- 进入Element装配
- 点击UI Controls中的Window控件一次，将其加入到页面上
- 点击左侧的Selected UI Controls，点击选中的Window控件
- 在右侧的控件面板中，设置Rect的第三行第一个input（对应Width）的值为200，设置第四行第一个input（对应Height）的值为200，从而将Window的宽和高设为200,200
- 点击UI Controls中的Button控件一次，将其加入到Window中，作为child（现在Button会跟随Window移动）
- 点击左侧的Selected UI Controls中Window前方的箭头，从而显示出它的child:Button
- 点击该Button，设置Rect的第二行第一个input（对应PositionY）的值为60。现在的截图如下所示：
![Button-PositionY.png](/img/搭建有事件响应和数据绑定的编辑器/Button-PositionY.png)
- 继续设置控件面板最下方的Event，选择ClickButton
从而监听了click事件，将事件handler与Action贡献绑定了
- 点击下图红框中的显示Element Inspector，从而能够编辑页面的数据State和Reducer
![Element-Inspector.png](/img/搭建有事件响应和数据绑定的编辑器/Element-Inspector.png)
- 点击右侧面板->State->Add Field，将Name设为x，Type选择int，Default Value设为0，然后点击Submit。这样就加入了页面数据：x
- 选择右侧面板->Reducer->Role为firstButton
- 点击右侧面板->Reducer->Add Field，选择ActioName为changeX，选择Field Name为x，点击Submit
- 点击左侧的Selected UI Controls中的Button
- 在右侧的控件面板中，选择Rect的第一行第二个select（对应PositionX）为x，从而将其与页面数据x绑定



## 运行编辑器页面

点击运行按钮，在运行页面中点击Button后，该Button会水平移动！



## 剩余的步骤

剩余的步骤的操作方法跟[搭建您的第一个编辑器](搭建您的第一个编辑器)中一样，具体有下面的步骤：
- 发布编辑器页面
- 选择编辑器页面贡献
- 搭建编辑器
- 发布编辑器
- 运行编辑器

最后我们看到成功运行了该编辑器